name: ğŸ¯ Paint-Only Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: âš¡ Sync Plugins & Themes
    runs-on: ubuntu-latest
    steps:
    - name: ğŸšš Get latest code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # ğŸ‘‡ THIS IS THE KEY TO SPEED (Fixes the "uploading everything" bug)
    - name: ğŸ•°ï¸ Restore Timestamps
      uses: chetan/git-restore-mtime-action@v2

    - name: ğŸ“‚ Install LFTP
      run: sudo apt-get install lftp

    - name: ğŸš€ Sync Content Folder
      run: |
        lftp -e "
        set ftp:ssl-allow yes;
        set ssl:verify-certificate no;
        open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_SERVER }};
        mirror --reverse \
               --delete \
               --parallel=5 \
               --verbose \
               --exclude-glob .git* \
               --exclude-glob .github/ \
               --exclude-glob .gitignore \
               --exclude-glob .DS_Store \
               --exclude-glob .env \
               --exclude-glob node_modules/ \
               --exclude-glob uploads/ \
               --exclude-glob cache/ \
               --exclude-glob upgrade/ \
               --exclude-glob backups/ \
               ./wp-content/ /public_html/wp-content/;
        quit"